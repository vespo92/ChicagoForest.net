# Chicago Forest Network Gateway - DNSMasq Configuration
# Provides DNS and DHCP services for the mesh network

# =============================================================================
# DNS Configuration
# =============================================================================

# Don't read /etc/resolv.conf
no-resolv

# Upstream DNS servers
server=1.1.1.1
server=8.8.8.8
server=9.9.9.9

# Local domain
local=/forest.local/
domain=forest.local
expand-hosts

# Cache settings
cache-size=10000
neg-ttl=300

# Security
domain-needed
bogus-priv
stop-dns-rebind
rebind-localhost-ok

# Don't forward short names
domain-needed

# =============================================================================
# DHCP Configuration
# =============================================================================

# Enable DHCP on Forest interface
# Interface name set via environment or default
# dhcp-range is set dynamically by entrypoint

# Lease file location
dhcp-leasefile=/var/lib/misc/dnsmasq.leases

# Default DHCP range (can be overridden)
dhcp-range=10.42.1.100,10.42.1.200,12h

# DHCP options
dhcp-option=option:router,10.42.1.1
dhcp-option=option:dns-server,10.42.1.1
dhcp-option=option:domain-name,forest.local
dhcp-option=option:ntp-server,10.42.1.1

# MTU for mesh network
dhcp-option=option:mtu,1400

# Domain search list
dhcp-option=option:domain-search,forest.local

# =============================================================================
# Static Leases
# =============================================================================

# Add static leases here for known devices
# dhcp-host=aa:bb:cc:dd:ee:ff,10.42.1.10,node-1
# dhcp-host=11:22:33:44:55:66,10.42.1.11,node-2

# =============================================================================
# Local DNS Records
# =============================================================================

# Gateway itself
address=/gateway.forest.local/10.42.1.1

# Add local records here
# address=/myserver.forest.local/10.42.1.50

# =============================================================================
# Logging
# =============================================================================

# Log DHCP transactions
log-dhcp

# Log DNS queries (disable in production for performance)
# log-queries

# Log facility
log-facility=/var/log/forest/dnsmasq.log

# =============================================================================
# Interface Binding
# =============================================================================

# Only bind to specific interfaces
bind-interfaces

# Listen on Forest interface (set by environment)
# interface=eth1

# Don't listen on WAN
except-interface=eth0
